var _toArray = function (arr) { return Array.isArray(arr) ? arr : Array.from(arr); };

document.addEventListener("DOMContentLoaded", init);

var zoom;
var $canvas;
var ctxt;

function init() {
  $canvas = document.getElementById("display");
  ctxt = $canvas.getContext("2d");

  var dropArea = window;

  // PreventDefault to prevent the browser from capturing the drop
  // event (and ask to save the PPM file or open it with the default
  // viewer).
  dropArea.addEventListener("dragenter", function (e) {
    e.preventDefault();
  });
  dropArea.addEventListener("dragover", function (e) {
    e.preventDefault();
  });
  dropArea.addEventListener("drop", function (e) {
    e.preventDefault();

    var file = e.dataTransfer.files[0];
    if (file == null) return error("No file was dropped");

    var reader = new FileReader();
    reader.onload = function () {
      display(reader.result);
    };
    reader.onerror = error;
    reader.readAsText(file);
  });

  var $zoom = document.getElementById("zoom");
  $zoom.addEventListener("input", function (_) {
    zoom = $zoom.value;
    $canvas.style.width = "" + $canvas.width * zoom + "px";
    $canvas.style.height = "" + $canvas.height * zoom + "px";
  });

  // Get zoom value from DOM.  The browser can save the set value from
  // a previous session, so itâ€™s not always set to the default value.
  zoom = $zoom.value;
}

function error(e) {
  console.error(e);
}

// Parse and display PPM object to canvas
function display(ppmString) {
  // Remove lines comment lines beginning with '#', then rejoin.
  var lines = ppmString.split("\n").filter(function (l) {
    return !l.match(/^#/);
  }).join("\n");

  var whitespace = /[ \t\r\n]+/;
  var fields = lines.split(whitespace);

  var _fields = _toArray(fields);

  var magic = _fields[0];
  var width = _fields[1];
  var height = _fields[2];
  var maxVal = _fields[3];

  var pixelData = _fields.slice(4);

  if (magic !== "P3") return error("Expected 'P3' magic number at the beginning of the file, got " + magic);

  width = parseInt(width, 10);
  if (isNaN(width)) return error("Expected a decimal value for width, got " + width);

  height = parseInt(height, 10);
  if (isNaN(height)) return error("Expected a decimal value for height, got " + height);

  maxVal = parseInt(maxVal, 10);
  if (isNaN(maxVal) || maxVal < 0 || maxVal >= 65536) return error("Expected a positive decimal less than 65536 for maximum color value, got " + maxVal);

  // Prepare canvas
  $canvas.width = width;
  $canvas.height = height;
  $canvas.style.width = "" + $canvas.width * zoom + "px";
  $canvas.style.height = "" + $canvas.height * zoom + "px";

  var imgData = ctxt.createImageData(width, height);
  var pixels = imgData.data;

  var to255 = 255 / maxVal;
  var pdi, pi, r, g, b, y, x;
  for (y = 0, pdi = 0, pi = 0; y < height; ++y) {
    for (x = 0; x < width; ++x, pdi += 3, pi += 4) {
      r = parseInt(pixelData[pdi]);
      if (isNaN(r)) return error("Expected a decimal value for red component, got " + r);
      g = parseInt(pixelData[pdi + 1]);
      if (isNaN(g)) return error("Expected a decimal value for green component, got " + g);
      b = parseInt(pixelData[pdi + 2]);
      if (isNaN(b)) return error("Expected a decimal value for blue component, got " + b);

      r *= to255;
      g *= to255;
      b *= to255;
      pixels.set([r, g, b, 255], pi);
    }
  }

  ctxt.putImageData(imgData, 0, 0);
}

//# sourceMappingURL=data:application/json;base64,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QUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO0FBQzVDLFNBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRTtBQUM3QyxPQUFDLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0FBQzVCLFVBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLE9BQU8sS0FBSyxzREFBb0QsQ0FBQyxDQUFHLENBQUE7QUFDbEYsT0FBQyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDaEMsVUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxLQUFLLHdEQUFzRCxDQUFDLENBQUcsQ0FBQTtBQUNwRixPQUFDLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUNoQyxVQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxPQUFPLEtBQUssdURBQXFELENBQUMsQ0FBRyxDQUFBOztBQUVuRixPQUFDLElBQUksS0FBSyxDQUFBO0FBQ1YsT0FBQyxJQUFJLEtBQUssQ0FBQTtBQUNWLE9BQUMsSUFBSSxLQUFLLENBQUE7QUFDVixZQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7S0FDNUI7R0FDRjs7QUFFRCxNQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7Q0FDakMiLCJmaWxlIjoid2VicHBtLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGluaXQpXG5cbnZhciB6b29tXG52YXIgJGNhbnZhc1xudmFyIGN0eHRcblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgJGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXNwbGF5JylcbiAgY3R4dCA9ICRjYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuXG4gIHZhciBkcm9wQXJlYSA9IHdpbmRvd1xuXG4gIC8vIFByZXZlbnREZWZhdWx0IHRvIHByZXZlbnQgdGhlIGJyb3dzZXIgZnJvbSBjYXB0dXJpbmcgdGhlIGRyb3BcbiAgLy8gZXZlbnQgKGFuZCBhc2sgdG8gc2F2ZSB0aGUgUFBNIGZpbGUgb3Igb3BlbiBpdCB3aXRoIHRoZSBkZWZhdWx0XG4gIC8vIHZpZXdlcikuXG4gIGRyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbnRlcicsIChlKSA9PiB7ZS5wcmV2ZW50RGVmYXVsdCgpfSlcbiAgZHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCAoZSkgPT4ge2UucHJldmVudERlZmF1bHQoKX0pXG4gIGRyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgdmFyIGZpbGUgPSBlLmRhdGFUcmFuc2Zlci5maWxlc1swXVxuICAgIGlmIChmaWxlID09IG51bGwpIHJldHVybiBlcnJvcignTm8gZmlsZSB3YXMgZHJvcHBlZCcpXG5cbiAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7ZGlzcGxheShyZWFkZXIucmVzdWx0KX1cbiAgICByZWFkZXIub25lcnJvciA9IGVycm9yXG4gICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSlcbiAgfSlcblxuICB2YXIgJHpvb20gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnem9vbScpXG4gICR6b29tLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgXyA9PiB7XG4gICAgem9vbSA9ICR6b29tLnZhbHVlXG4gICAgJGNhbnZhcy5zdHlsZS53aWR0aCA9IGAkeyRjYW52YXMud2lkdGggKiB6b29tfXB4YFxuICAgICRjYW52YXMuc3R5bGUuaGVpZ2h0ID0gYCR7JGNhbnZhcy5oZWlnaHQgKiB6b29tfXB4YFxuICB9KVxuXG4gIC8vIEdldCB6b29tIHZhbHVlIGZyb20gRE9NLiAgVGhlIGJyb3dzZXIgY2FuIHNhdmUgdGhlIHNldCB2YWx1ZSBmcm9tXG4gIC8vIGEgcHJldmlvdXMgc2Vzc2lvbiwgc28gaXTigJlzIG5vdCBhbHdheXMgc2V0IHRvIHRoZSBkZWZhdWx0IHZhbHVlLlxuICB6b29tID0gJHpvb20udmFsdWVcbn1cblxuZnVuY3Rpb24gZXJyb3IoZSkgeyBjb25zb2xlLmVycm9yKGUpIH1cblxuXG4vLyBQYXJzZSBhbmQgZGlzcGxheSBQUE0gb2JqZWN0IHRvIGNhbnZhc1xuZnVuY3Rpb24gZGlzcGxheShwcG1TdHJpbmcpIHtcbiAgLy8gUmVtb3ZlIGxpbmVzIGNvbW1lbnQgbGluZXMgYmVnaW5uaW5nIHdpdGggJyMnLCB0aGVuIHJlam9pbi5cbiAgdmFyIGxpbmVzID0gcHBtU3RyaW5nLnNwbGl0KCdcXG4nKVxuICAgIC5maWx0ZXIobCA9PiAhbC5tYXRjaCgvXiMvKSlcbiAgICAuam9pbignXFxuJylcblxuICB2YXIgd2hpdGVzcGFjZSA9IC9bIFxcdFxcclxcbl0rL1xuICB2YXIgZmllbGRzID0gbGluZXMuc3BsaXQod2hpdGVzcGFjZSlcblxuICB2YXIgW21hZ2ljLCB3aWR0aCwgaGVpZ2h0LCBtYXhWYWwsIC4uLnBpeGVsRGF0YV0gPSBmaWVsZHNcblxuICBpZiAobWFnaWMgIT09ICdQMycpXG4gICAgcmV0dXJuIGVycm9yKGBFeHBlY3RlZCAnUDMnIG1hZ2ljIG51bWJlciBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBmaWxlLCBnb3QgJHttYWdpY31gKVxuXG4gIHdpZHRoID0gcGFyc2VJbnQod2lkdGgsIDEwKVxuICBpZiAoaXNOYU4od2lkdGgpKVxuICAgIHJldHVybiBlcnJvcihgRXhwZWN0ZWQgYSBkZWNpbWFsIHZhbHVlIGZvciB3aWR0aCwgZ290ICR7d2lkdGh9YClcblxuICBoZWlnaHQgPSBwYXJzZUludChoZWlnaHQsIDEwKVxuICBpZiAoaXNOYU4oaGVpZ2h0KSlcbiAgICByZXR1cm4gZXJyb3IoYEV4cGVjdGVkIGEgZGVjaW1hbCB2YWx1ZSBmb3IgaGVpZ2h0LCBnb3QgJHtoZWlnaHR9YClcblxuICBtYXhWYWwgPSBwYXJzZUludChtYXhWYWwsIDEwKVxuICBpZiAoaXNOYU4obWF4VmFsKSB8fCBtYXhWYWwgPCAwIHx8IG1heFZhbCA+PSA2NTUzNilcbiAgICByZXR1cm4gZXJyb3IoYEV4cGVjdGVkIGEgcG9zaXRpdmUgZGVjaW1hbCBsZXNzIHRoYW4gNjU1MzYgZm9yIG1heGltdW0gY29sb3IgdmFsdWUsIGdvdCAke21heFZhbH1gKVxuXG4gIC8vIFByZXBhcmUgY2FudmFzXG4gICRjYW52YXMud2lkdGggPSB3aWR0aFxuICAkY2FudmFzLmhlaWdodCA9IGhlaWdodFxuICAkY2FudmFzLnN0eWxlLndpZHRoID0gYCR7JGNhbnZhcy53aWR0aCAqIHpvb219cHhgXG4gICRjYW52YXMuc3R5bGUuaGVpZ2h0ID0gYCR7JGNhbnZhcy5oZWlnaHQgKiB6b29tfXB4YFxuXG4gIHZhciBpbWdEYXRhID0gY3R4dC5jcmVhdGVJbWFnZURhdGEod2lkdGgsIGhlaWdodClcbiAgdmFyIHBpeGVscyA9IGltZ0RhdGEuZGF0YVxuXG4gIHZhciB0bzI1NSA9IDI1NSAvIG1heFZhbFxuICB2YXIgcGRpLCBwaSwgciwgZywgYiwgeSwgeFxuICBmb3IgKHkgPSAwLCBwZGkgPSAwLCBwaSA9IDA7IHkgPCBoZWlnaHQ7ICsreSkge1xuICAgIGZvciAoeCA9IDA7IHggPCB3aWR0aDsgKyt4LCBwZGkgKz0gMywgcGkgKz0gNCkge1xuICAgICAgciA9IHBhcnNlSW50KHBpeGVsRGF0YVtwZGldKVxuICAgICAgaWYgKGlzTmFOKHIpKSByZXR1cm4gZXJyb3IoYEV4cGVjdGVkIGEgZGVjaW1hbCB2YWx1ZSBmb3IgcmVkIGNvbXBvbmVudCwgZ290ICR7cn1gKVxuICAgICAgZyA9IHBhcnNlSW50KHBpeGVsRGF0YVtwZGkgKyAxXSlcbiAgICAgIGlmIChpc05hTihnKSkgcmV0dXJuIGVycm9yKGBFeHBlY3RlZCBhIGRlY2ltYWwgdmFsdWUgZm9yIGdyZWVuIGNvbXBvbmVudCwgZ290ICR7Z31gKVxuICAgICAgYiA9IHBhcnNlSW50KHBpeGVsRGF0YVtwZGkgKyAyXSlcbiAgICAgIGlmIChpc05hTihiKSkgcmV0dXJuIGVycm9yKGBFeHBlY3RlZCBhIGRlY2ltYWwgdmFsdWUgZm9yIGJsdWUgY29tcG9uZW50LCBnb3QgJHtifWApXG5cbiAgICAgIHIgKj0gdG8yNTVcbiAgICAgIGcgKj0gdG8yNTVcbiAgICAgIGIgKj0gdG8yNTVcbiAgICAgIHBpeGVscy5zZXQoW3IsZyxiLDI1NV0sIHBpKVxuICAgIH1cbiAgfVxuXG4gIGN0eHQucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIDAsIDApXG59XG4iXX0=